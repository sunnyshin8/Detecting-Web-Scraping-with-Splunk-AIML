# savedsearches.conf - Automated alerts for web scraping infrastructure detection

[High Risk Infrastructure Alert]
search = index=network sourcetype=client_hostname_data | where bot_infrastructure_score >= 10 OR suspicious_pattern="Bot_Infrastructure" | stats count as high_risk_ips, values(hosting_provider) as providers, values(suspicious_pattern) as patterns by client_ip | where high_risk_ips > 0 | eval alert_message = "CRITICAL: High-risk bot infrastructure detected - IP: " + client_ip + " Providers: " + mvjoin(providers, ",")
dispatch.earliest_time = -15m
dispatch.latest_time = now
cron_schedule = */15 * * * *
enableSched = 1
alert.track = 1
alert.severity = 2
action.email = 1
action.email.to = security-team@company.com
action.email.subject = Infrastructure Alert: High-Risk Bot Infrastructure Detected
action.email.message = High-risk bot infrastructure has been identified. Review the attached results for immediate action.

[Suspicious Hosting Concentration Alert]
search = index=network sourcetype=client_hostname_data earliest=-1h | where hosting_provider != "Unknown" | stats count as hosting_count by hosting_provider | where hosting_count > 500 | eval alert_message = "Large concentration of " + hosting_provider + " infrastructure detected: " + tostring(hosting_count) + " IPs"
dispatch.earliest_time = -1h
dispatch.latest_time = now
cron_schedule = 0 * * * *
enableSched = 1
alert.track = 1
alert.severity = 3
action.email = 1
action.email.to = security-team@company.com
action.email.subject = Infrastructure Alert: Unusual Hosting Provider Concentration

[Anonymization Infrastructure Alert]
search = index=network sourcetype=client_hostname_data earliest=-30m | where suspicious_pattern="Anonymization" OR match(hostname, "(?i)proxy|vpn|tor") | stats count as anon_ips, values(client_ip) as ip_list | where anon_ips > 10 | eval alert_message = "Anonymization infrastructure spike: " + tostring(anon_ips) + " IPs detected"
dispatch.earliest_time = -30m
dispatch.latest_time = now
cron_schedule = */30 * * * *
enableSched = 1
alert.track = 1
alert.severity = 3
action.email = 1
action.email.to = security-team@company.com
action.email.subject = Infrastructure Alert: Anonymization Services Detected

[DNS Resolution Anomaly Alert]
search = index=network sourcetype=client_hostname_data earliest=-4h | stats count as total, count(eval(has_reverse_dns=="false")) as no_dns | eval no_dns_rate = (no_dns / total) * 100 | where no_dns_rate > 70 | eval alert_message = "DNS resolution anomaly: " + tostring(round(no_dns_rate,1)) + "% of IPs have no reverse DNS"
dispatch.earliest_time = -4h
dispatch.latest_time = now
cron_schedule = 0 */4 * * *
enableSched = 1
alert.track = 1
alert.severity = 4
action.email = 1
action.email.to = security-team@company.com
action.email.subject = Infrastructure Alert: DNS Resolution Anomaly

[New Malicious Infrastructure Alert]
search = index=network sourcetype=client_hostname_data earliest=-15m | where suspicious_pattern="Malicious" OR match(hostname, "(?i)hack|exploit|attack|malware") | stats count as malicious_ips, values(client_ip) as threat_ips | where malicious_ips > 0 | eval alert_message = "URGENT: Malicious infrastructure detected - " + tostring(malicious_ips) + " threatening IPs identified"
dispatch.earliest_time = -15m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
alert.track = 1
alert.severity = 1
action.email = 1
action.email.to = security-team@company.com,soc@company.com
action.email.subject = URGENT: Malicious Infrastructure Detected

[Hosting Provider Anomaly Alert]
search = index=network sourcetype=client_hostname_data earliest=-2h | where hosting_provider != "Unknown" | stats count as provider_count by hosting_provider | eventstats avg(provider_count) as avg_count, stdev(provider_count) as stdev_count | where provider_count > (avg_count + (2 * stdev_count)) | eval alert_message = "Hosting provider anomaly: " + hosting_provider + " has " + tostring(provider_count) + " IPs (significantly above normal)"
dispatch.earliest_time = -2h
dispatch.latest_time = now
cron_schedule = 0 */2 * * *
enableSched = 1
alert.track = 1
alert.severity = 4
action.email = 1
action.email.to = security-team@company.com
action.email.subject = Infrastructure Alert: Hosting Provider Anomaly
